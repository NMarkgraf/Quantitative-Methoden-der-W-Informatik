\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{beamerthemeNPBT}[2022/02/25 v5.0.5 Main Beamer Theme of NPBT]
% ===========================================================================
% beamerthemeNPBT.sty
% ===================---------------------------------------------------------
%
% (C) in 2017-22 by Norman Markgraf (nmarkgraf(at)hotmail(dot)com)
%
% NPBT <-> Norman's Pandoc Beamer Theme -> NPBT
% ----     =        =      =      =        ====
%
% ---------------------------------------------------------------------------
%
\message{Starting 'beamerthemeNPBT' ----------------------------------------}
\mode<presentation>
% ---------------------------------------------------------------------------
% Used Packages:
% ---------------------------------------------------------------------------
% The 'ifthen' package’s basic command is \ifthenelse, which can use a wide
% array of tests. Also provided is a simple loop command \whiledo.
\RequirePackage{ifthen}
% ---------------------------------------------------------------------------
\RequirePackage{multicol} % Für das zweispaltige TOC.
% ---------------------------------------------------------------------------
% 'calc' adds infix expressions to perform arithmetic on the arguments of the
% LaTeX commands \setcounter, \addtocounter, \setlength, and \addtolength.
% Since many packages start their arithmetic by storing an argument in a
% register, the package has wide applicability.
\RequirePackage{calc}
% ---------------------------------------------------------------------------
\RequirePackage{ragged2e} % Liefert FlushRight-Umgebung
% ---------------------------------------------------------------------------
\RequirePackage{tikz}
\usetikzlibrary{positioning}
\usetikzlibrary{calc}
\usetikzlibrary{backgrounds}
% ---------------------------------------------------------------------------
\RequirePackage{xspace}
% ---------------------------------------------------------------------------
% \RequirePackage{array} % Wird durch das template geladen!
% ---------------------------------------------------------------------------
% xstring Paket
% Wird für \IfString ... etc benutzt.
%
% https://ftp.rrzn.uni-hannover.de/pub/mirror/tex-archive/macros/generic/xstring/xstring-en.pdf
\RequirePackage{xstring}
% ---------------------------------------------------------------------------
% 'upgreek' is a package to provide the upright Greek letters from the
% Euler or Adobe Symbol fonts as additional math symbols
% (\upalpha, \upbeta, etc.), with proper spacing and scaling in
% super- and subscripts.
\RequirePackage{upgreek}
% ---------------------------------------------------------------------------
% SETSPACE ist leider inkompatible mit beamer! "footnote<.->" läuft dann nicht!
% ---------------------------------------------------------------------------
%\RequirePackage{setspace} % Wunsch von R.B. Drescher ;-)
%\AfterPackage*{setspace}{%
%  \makeatletter
%  \ifthenelse{\isundefined{\@ptsize}}{%
%    \global\newlength\@ptsize%
%    \global\@ptsize=12pt%
%  }{%
%    \relax%
%  }%
%  \renewcommand*{\onehalfspacing}{%
%    \ifdim \@ptsize =\@ne pt
%      \setstretch{1.213}%
%    \else \ifdim \@ptsize =\tw@ pt
%      \setstretch{1.241}%
%    \else
%      \setstretch{1.25}%
%    \fi\fi
%  }%
%  \renewcommand*{\doublespacing}{%
%    \ifdim \@ptsize =\@ne pt
%      \setstretch{1.618}%
%    \else \ifdim \@ptsize =\tw@ pt
%      \setstretch{1.655}%
%    \else
%      \setstretch{1.667}%
%    \fi\fi
%  }%
%  \makeatother
%
%}
% ---------------------------------------------------------------------------
\RequirePackage{verbatimbox}
% ---------------------------------------------------------------------------
% \RequirePackage{booktabs} % wird durch das Template geladen!
% ---------------------------------------------------------------------------
\RequirePackage{colortbl}
% ---------------------------------------------------------------------------
% This package extends the standard graphicx package by providing the missing
% \trimbox and \clipbox macros to trim and clip arbitrary TEX material.
% The macros allow for verbatim content. Equivalent environments are also
% provided. The package comes with own clipping drivers for all common output
% formats as well as a pgf fall-back driver
%
% Wir nutzen \clipbox  um die Überlänge bei "/" zu reduzieren.
\ifpdftex{%
    \RequirePackage{trimclip}%
}\else{
    % Aber nicht für XeLaTeX und LuaLaTeX, daher:
    \newcommand{\clipbox}[2]{#2}%
}\fi
% ---------------------------------------------------------------------------
% TEX’s \let assignment does not work for LATEX macros with optional arguments
% or for macros that are defined as robust macros by \DeclareRobustCommand.
% This package defines \LetLtxMacro that also takes care of the involved
% internal macros.
%
% Wird hier genutzt um unsere TOC zu modifizieren. (Z.z. in "header.tex")
\RequirePackage{letltxmacro}
% ---------------------------------------------------------------------------
% This package can disable all hyphenation or enable hyphenation of
% non-alphabetics or monospaced fonts.
% The package can also enable hyphenation within ‘words’ that contain
% non-alphabetic characters (e.g., that include underscores), and hyphenation
% of text typeset in monospaced (e.g., cmtt) fonts.
\RequirePackage{hyphenat}  % Kann vielleicht weg???
% ---------------------------------------------------------------------------
\RequirePackage{eurosym}
% ---------------------------------------------------------------------------

%% Für mehr Leerzeichen in den Dateinamen bei includegraphic und Co:
% http://ftp.fau.de/ctan/macros/latex/contrib/oberdiek/grffile.pdf
%
%\usepackage[space]{grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ifpdf{% pdflatex
    \relax%
}\else{% LuaLaTeX oder XeLaTeX
    \defaultfontfeatures[\rmfamily]{%
        Ligatures=TeX,%
        Scale=0.9%
    }%
}\fi
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% ---------------------------------------------------------------------------
% **** DEPRICATED ****
% Statt \widerfalse/true soll hier die Varible npbt@screenratio benutzt werden
% Diese kann die Werte 43 oder 169 oder 1610 haben.
% ---------------------------------------------------------------------------
\newif\ifwider % 4x3 or 16x9
\widerfalse
\message{SET wider or not (base):}
\ifwider{%
    \message{SET TO 16x9!}
}\else{%
    \message{SET TO 4x3!}
}\fi

% ---------------------------------------------------------------------------
%
% Übungen und offene Übungen haben bei der FOM einen etwas anderen
% Hintergrund beim Frametitle. Hier wird ein Schalter dazu erzeugt und
% und auf die normale Darstellung (false) gesetzt.
%
\newif\ifnpbtexercisemode
%\npbtexercisemodefalse

% ---------------------------------------------------------------------------
%
% Lösungen zu Übunge haben bei der FOM (DLS) einen etwas anderen
% Hintergrund beim Frametitle. Hier wird ein Schalter dazu erzeugt und
% und auf die normale Darstellung (false) gesetzt.
%
\newif\ifnpbtsolutionemode
\npbtsolutionemodefalse

% ---------------------------------------------------------------------------
% Sind wir gerade in einer Notes Umgebung oder nicht?
%
\newif\ifnotesmode
\notesmodefalse

% ---------------------------------------------------------------------------
%
% Digitales Live Studium
% Ist dieses Skript gesetzt für das Digitale Live Studium?
%
\newif\ifDLS
\DLSfalse
\DeclareOption{DLS}{\DLStrue}
\ProcessOptions
\ifDLS{%
    \widertrue%
    \message{SET DLS TO WIDER!}%
}\else{ %
    \relax%
}\fi

% ---------------------------------------------------------------------------
\def\softness{0.8}

\definecolor{softred}{rgb}{1,\softness,\softness}
\definecolor{softgreen}{rgb}{\softness,1,\softness}
\definecolor{softblue}{rgb}{\softness,\softness,1}
% ---------------------------------------------------------------------------
\definecolor{NPBTblue}{rgb}{0.77,0.58,0.75}
\definecolor{NPBT}{rgb}{0,0.67,0.6}
\definecolor{NPBTTitelColor}{RGB}{0,38,153}

% ---------------------------------------------------------------------------
\setbeamercolor*{structure}{fg=NPBTblue, bg=softblue}
\setbeamercolor{structure}{fg=NPBT}

% ---------------------------------------------------------------------------
% title page
% ---------------------------------------------------------------------------
\setbeamercolor{title in titlepage}{fg=NPBTTitelColor}
\setbeamercolor{subtitle in titlepage}{fg=NPBTTitelColor}
\setbeamercolor{institute in titlepage}{fg=lightgray}
\setbeamercolor{author in titlepage}{fg=darkgray}

% ---------------------------------------------------------------------------
\setbeamerfont{title in titlepage}{size=\Large, series=\bfseries}
\setbeamerfont{subtitle in titlepage}{size=\large, series=\bfseries}
\setbeamerfont{institute in titlepage}{size=\large, series=\bfseries}
\setbeamerfont{author in titlepage}{series=\bfseries}

% ---------------------------------------------------------------------------
% part title page
% ---------------------------------------------------------------------------
\setbeamercolor{part title}{fg=NPBTTitelColor}

% ---------------------------------------------------------------------------
% section title page
% ---------------------------------------------------------------------------
\setbeamercolor{section name}{fg=NPBTTitelColor}
\setbeamercolor{section title}{fg=NPBTTitelColor}

% ---------------------------------------------------------------------------
\setbeamerfont{section name}{size=\Large, family=\sffamily, series=\bfseries}

% ---------------------------------------------------------------------------
% subsection title page
% ---------------------------------------------------------------------------
\setbeamercolor{subsection name}{fg=NPBTTitelColor}
\setbeamercolor{subsection title}{fg=NPBTTitelColor}

% ---------------------------------------------------------------------------
\setbeamerfont{subsection name}{size=\large, family=\sffamily, series=\bfseries}

% ---------------------------------------------------------------------------
% header
% ---------------------------------------------------------------------------
\setbeamercolor{myheader}{fg=darkgray}
\setbeamercolor{section in head}{parent=myheader}
\setbeamercolor{subsection in head}{parent=myheader}
\setbeamercolor{frametitle in head}{parent=myheader, fg=NPBTTitelColor}
\setbeamercolor{frametitle in head exercise}{parent=myheader, bg=NPBTTitelColor, fg=white}

% ---------------------------------------------------------------------------
\setbeamerfont{myheader}{}
\setbeamerfont{section in head}{parent=myheader}
\setbeamerfont{subsection in head}{parent=myheader}
\setbeamerfont{frametitle in head}{parent=myheader}
\setbeamerfont{frametitle in head exercise}{parent=myheader}

% ---------------------------------------------------------------------------
\setbeamercolor{footer}{fg=normal text.fg}
\setbeamercolor{author in footer}{parent=footer}
\setbeamercolor{date in footer}{parent=footer}
\setbeamercolor{title in footer}{parent=footer}
\setbeamercolor{framenumber in footer}{parent=footer}

% ---------------------------------------------------------------------------
%
\setbeamerfont{block title}{size={}}
% . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
\setbeamerfont{frametitle}{shape=\upshape,family=\sffamily,series=\mdseries}

% ---------------------------------------------------------------------------
\useinnertheme{rounded}
%
% FIX ME!!!
%
\setbeamertemplate{items}[default] % Anpassung für DLS
\setbeamertemplate{itemize items}[default] % Anpassung für DLS
\setbeamertemplate{enumerate items}[default]
\setbeamertemplate{navigation symbols}{}

% ---------------------------------------------------------------------------
% Font setting
% . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
% Mathematische Formeln mit Serifen
%
%%%% \usefonttheme[onlymath]{serif} %%% DLS????

% ---------------------------------------------------------------------------
%running fraction with slash - requires math mode.
\newcommand*\rfrac[2]{\ensuremath{{}^{#1}\!/_{#2}}}

% ---------------------------------------------------------------------------
%
% Fontsetting
% ===========
%
% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - %
\message{** FONTSETTING *************************************************}
\ifPDFTeX{% pdf-LaTeX Fontsetting                                             %
\message{beamerthemeNPBT fontsetting is running in PDFLATEX mode!}
% . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
% # Latin Modern
% Die LaTeX Standardschrift ist die Latin Modern (lmodern Paket).
% If Latin Modern is not available for your distribution you must install the
% package cm-super instead. Otherwise your fonts will look horrible in the PDF
%
  \usepackage{lmodern}
% . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
%
% needed for all T1 fonts!
  \usepackage[T1]{fontenc} 	% sonst wird OT1 coding ausgegeben
%							% und dann funktioniert Myriad (pmy) nicht mehr
  \usepackage{textcomp} 		% sonst wird OT1 coding ausgegeben
%							% und dann funktioniert Myriad (pmy) nicht mehr

% . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
% # Palantino: Serifen für die Mathematischen Formeln (pplx, pplj)

\usepackage[%
  osf,
  sc
]{mathpazo}

%\renewcommand{\sfdefault}{pplx}
%\renewcommand{\sfdefault}{pplj}
%
% . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
% # Schrifttype eulervm / Euler Virtual Math
%
% URL:
% http://ftp.riken.jp/tex-archive/fonts/eulervm/doc/latex/eulervm/eulervm.pdf
%  Zitat: Do not use the Euler math fonts in conjunction with the default
%         Computer Modern text fonts – this is ugly!
  \usepackage[                           %% --- EulerVM (MATH)
    small,       %for smaller Fonts
    OT1,
%   euler-digits % digits in euler fonts style
  ]{eulervm}
%
% . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
% \DeclareSymbolFont{operators}   {OT1}{cmr} {m}{n}
  \DeclareSymbolFont{letters}     {OML}{zplm} {m}{it}
% \DeclareSymbolFont{symbols}     {OMS}{cmsy}{m}{n}
% . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
% ---------------------------------------------------------------------------
% eurosym für das Euro-Symbol
% =======
%
% Als Option "official" für das "offizelle" Eurosymbol
%
%\usepackage[official]{eurosym}
%
    \usepackage{eurosym}
% Eurosymbol auch in mathematischen Formeln richtig darstellen
%
    \DeclareRobustCommand{\officialeuro}{%
      \ifmmode\expandafter\text\fi
      {\fontencoding{U}\fontfamily{eurosym}\selectfont e}}
%
% \euro in UTF-8 als Standard-Eurozeichen definieren
%
    \DeclareUnicodeCharacter{20AC}{\euro}
%
}\else{%
    \message{beamerthemeNPBT fontsetting is running in XeLaTeX or LuaLaTeX mode!}
    \usepackage{eurosym}
}\fi
\message{** END FONTSETTING *************************************************}

% = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =
%
% Schauen wir uns mal die Einstellungen von beamer an und ändern das ggf.
%
% ---------------------------------------------------------------------------
%
% Einstellungen für 16x9:
\newlength{\myPaperWidthWide}
\newlength{\myPaperHeightWide}
\setlength{\myPaperWidthWide}{224mm}
\setlength{\myPaperHeightWide}{126mm}
%
% Einstellungen für 4x3:
\newlength{\myPaperWidthNormal}
\newlength{\myPaperHeightNormal}
\setlength{\myPaperWidthNormal}{160mm}
\setlength{\myPaperHeightNormal}{120mm}
%
\newlength{\myPaperWidth}
\newlength{\myPaperHeight}
%
\let\myPaperWidth\myPaperWidthNormal
\let\myPaperHeight\myPaperHeightNormal
%
\message{SET to \the\myPaperWidth x \the\myPaperHeight (pre)}
%
\ifwider{ % 16:9
    \global\let\myPaperWidth\myPaperWidthWide
    \global\let\myPaperHeight\myPaperHeightWide
    \message{SET myPaperWidth TO 16x9!}
    \message{SET to \the\myPaperWidth x \the\myPaperHeight (inner)}
}\else{ % 4:3
    \message{SET myPaperWidth TO 4x3!}
    \message{SET to \the\myPaperWidth x \the\myPaperHeight (inner)}
}\fi

\message{SET to \the\myPaperWidth x \the\myPaperHeight (mid)}

\makeatletter
%\beamer@paperwidth
%\beamer@paperheight
\ifthenelse{\lengthtest{\beamer@paperwidth = 16.00cm}}{%
    % 16 zu ...
    \setlength{\myPaperWidth}{224mm}
    \ifthenelse{\lengthtest{\beamer@paperheight = 10.0cm}}{
        % 16:10
        \setlength{\myPaperHeight}{140mm}
        \message{Set ScreenRatio to 16:10 (224x140)}
    }{%
        % 16:9
        \setlength{\myPaperHeight}{126mm}
        \message{Set ScreenRatio to 16:9 (224x126)}
    }
    \setlength{\beamer@paperwidth}{\myPaperWidth}
    \setlength{\beamer@paperheight}{\myPaperWidth}
}{%
    % nicht 16 zu ...
    \ifthenelse{\lengthtest{\beamer@paperwidth = 12.80cm}}{%
    % 4:3 ?
    }{
        \ifthenelse{\lengthtest{\beamer@paperheight = 9.60cm}}{%
            % 4:3 !
            \setlength{\myPaperWidth}{160mm}
    	    \setlength{\myPaperHeight}{120mm}
    	    \setlength{\beamer@paperwidth}{\myPaperWidth}
    	    \setlength{\beamer@paperheight}{\myPaperWidth}
    	    \message{Set ScreenRatio to 4:3 (160x120)}
        }{%
            \relax
        }
    }

}
\makeatother
\message{SET to \the\myPaperWidth x \the\myPaperHeight (post)}

\geometry{paperwidth=\myPaperWidth, paperheight=\myPaperHeight}

\newcommand*{\setScreenRatio}[1]{%
    %
    % Default:
    %
    \setlength{\myPaperWidth}{140mm}
    \setlength{\myPaperHeight}{105mm}

    \ifthenelse{\equal{#1}{4x3}}{%
    %\ifstrequal{#1}{4x3}{%
    	%% 4:3 -> 160 x 120
    	\setlength{\myPaperWidth}{160mm}
    	\setlength{\myPaperHeight}{120mm}
    	\message{Set ScreenRatio to 4:3 (160x120)}
    	% Powerpoint-Layout
    	%\setlength{\myPaperWidth}{254mm}
    	%\setlength{\myPaperHeight}{191mm}
    	\message{Set ScreenRatio to 4:3 (254x191)}
    }{
        \ifthenelse{\equal{#1}{16x9}}{%
    %	\ifstrequal{#1}{16x9}{%
    		%% 16:9 ->  224 x 126
    		\setlength{\myPaperWidth}{224mm}
    		\setlength{\myPaperHeight}{126mm}
    	\message{Set ScreenRatio to 16:9 (224x126)}
    	}{%
    		%% Default:
    		\setlength{\myPaperWidth}{140mm}
    		\setlength{\myPaperHeight}{105mm}
    		\message{Set ScreenRatio to default (140x105)}
    	}
    }
    \geometry{paperwidth=\myPaperWidth,paperheight=\myPaperHeight}
}

%%%%%%
%\ifDLS{%
%    \setScreenRatio{16x9}%
%}\else{%
%    \setScreenRatio{4x3}
%}\fi
%\setScreenRatio{16x9}
%%%%%%

\def\footlinesize{\scriptsize} % \tiny\footnotesize\scriptsize

% ===========================================================================
% Customizing geometry.
% ---------------------
% Sollte es eine Datei "customize_geom.tex" geben, so wird diese an dieser
% Stelle geladen um die \geometry-Anweisungen ggf. zu überschreiben.
% ---------------------------------------------------------------------------
\InputIfFileExists{customize_geom.tex}{\relax}{\relax}
%
% ===========================================================================
%
% ---------------------------------------------------------------------------
%
\def\imagepath{images/NPBT-SC-}

\def\npbtBackground{background}
\def\npbtLogo{logo}
\ifwider{ % 16:9
    \global\def\npbtBackground{background-169}
    \message{We are in wider mode, so add '-169' to background.}
}\else{
    \global\def\npbtBackground{background}
    \message{We are not in wieder mode.}
}\fi

\newcommand{\updateNPBTimagespaths}{%
	\def\backgroundimage{\imagepath\npbtBackground}
	\def\logoimage{\imagepath\npbtLogo}
}
\updateNPBTimagespaths{}

\def\logowidth{1cm}
\def\logoheight{1cm}
\def\logoxshift{-0.78cm}
\def\logoyshift{-0.82cm}
%
\def\titleboxwidth{0.5\linewidth}
\def\sectiontitleboxwidth{0.75\linewidth}
\def\sectionpagewidth{0.5\myPaperWidth}
\def\sectionpageheight{0.25\myPaperHeight}
\def\subsectionpagewidth{0.5\myPaperWidth}
\def\subsectionpageheight{0.25\myPaperHeight}
%
\def\myleftskip{0.4cm}
\def\myrightskip{0.0cm}
\def\mysepsize{0.6em}

% My FrameTitleBox ...
\newsavebox{\myftbox}
\newsavebox{\maxheightbox}
\newlength{\myftboxwidth}
\newlength{\myftboxmaxwidth}
\setlength{\myftboxmaxwidth}{390pt}
\def\myftboxscale{1.0}


\makeatletter
\long\def\beamer@@frametitle[#1]#2{%
  \global\npbtexercisemodefalse\message{SET exercisemode to FALSE}%
  \beamer@ifempty{#2}{}{%
    \expandarg%
    \IfSubStr*{#2}{bung}{\global\npbtexercisemodetrue}{}%  *****
    \IfBeginWith*{#2}{Offene}{\global\npbtexercisemodetrue}{}%
    \gdef\beamer@frametitle{#2}%
    \gdef\insertframetitle{{\beamer@frametitle\ifnum\beamer@autobreakcount>0\relax{}\space\usebeamertemplate*{frametitle continuation}\fi}}%
    \gdef\beamer@shortframetitle{#1}%
  }%
}
\makeatother

% ---------------------------------------------------------------------------
%
% Die sich regelmässig wiederholenden Bildelemente werden in pgf gespeichert
% und wiederverwendet. Dazu werden die folgenden Bezeichner verwendet:
%
% npbtlogo                :
%
% Mit dem Befehl "\updateNPBTimages" werden diese Bezeichner auf die aktuellen
% Werte gesetzt, falls diese durch themes geändert werden/wurden.
%
\newlength{\logowidthheight}
\setlength{\logowidthheight}{1.0cm}

\newcommand*{\updateNPBTimages}{%
  \message{Trying to load logoimage '\logoimage'}
  \ifDLS{%
    \relax%
  }\else{%
      \IfFileExists{\logoimage}{%
          \setlength{\logowidthheight}{1.0cm}
          \pgfdeclareimage[%
              width=\logowidthheight,
              height=\logowidthheight
          ]{npbtlogo}{\logoimage}
      }{%
        \message{File not found logoimage '\logoimage'}
        \relax
      }
  }\fi
}
\updateNPBTimagespaths{}
\updateNPBTimages{}

% ---------------------------------------------------------------------------
%
% logoline
%

\newcommand{\showLogoRightSide}{%
  \ifDLS{\relax}\else{%
      \begin{tikzpicture}[remember picture, overlay]%
        \node[%
        shift={(\logoxshift,\logoyshift)},
        inner sep=0pt
        ] at (current page.north east){%
            \ifpdftex{%
                \pgfuseimage{npbtlogo}%
            }\else{%
                \includegraphics[%
                    width=\logowidthheight,%
                    height=\logowidthheight%
                ]{\logoimage}%
            }\fi%
        };%
      \end{tikzpicture}%
    }\fi%
}

% ---------------------------------------------------------------------------
%
% title page:
%
\defbeamertemplate{title page}{minimal}
{
  \inserttitle
  \par
  \insertsubtitle
  \par\par

  \insertinstitute ~\xspace -- \insertdate
  \par

  \insertauthor
  \par
}

\defbeamertemplate{title page}{normal}
{
  \begin{tikzpicture}[remember picture, overlay]
    \node[inner sep=0pt] at (current page.center){%
        \includegraphics[%
            width=\myPaperWidth, %
            height=\myPaperHeight %
        ]{\backgroundimage}%
      };%
    \node[%
      anchor=south east,
      xshift=-1.95cm,
      yshift=3.65cm
    ] at (current page.south east){%
        \begin{minipage}[b]{0.8\textwidth}%{\titleboxwidth}
            \addtolength{\baselineskip}{1.5ex}
            \begin{flushright} % XXXX
                {\usebeamercolor[fg]{title in titlepage}%
                 \usebeamerfont{title in titlepage} \inserttitle}
                \par
                {\usebeamercolor[fg]{subtitle in titlepage}%
                 \usebeamerfont{subtitle in titlepage} \insertsubtitle}
                 \par
                \vspace*{0.7em}
                \ifDLS{\relax}\else{ % Keine Institutsangaben beim DLS
                    {\usebeamercolor[fg]{institute in titlepage}%
                     \usebeamerfont{institute in titlepage} \insertinstitute ~\xspace -- \insertdate}
                    \usebeamerfont{institute in titlepage}\par
                    }%
                \fi%
                {\usebeamercolor[fg]{author in titlepage}%
                 \usebeamerfont{author in titlepage} \insertauthor}
            \end{flushright} % XXXX
        \end{minipage}
    };%
  \end{tikzpicture}%
  \showLogoRightSide%
}

\defbeamertemplate{title page}{normalDLS}
{
  \begin{tikzpicture}[remember picture, overlay]
    \node[inner sep=0pt] at (current page.center){%
        \includegraphics[%
            width=\myPaperWidth, %
            height=\myPaperHeight %
        ]{\backgroundimage}%
      };%
    \node[%
      anchor=south east,
      xshift=-1.95cm,
      yshift=3.65cm
    ] at (current page.south east){%
        \begin{minipage}[b]{0.8\textwidth}%{\titleboxwidth}
            \addtolength{\baselineskip}{1.5ex}
            \begin{flushright} % XXXX
                {\usebeamercolor[fg]{title in titlepage}%
                 \usebeamerfont{title in titlepage} \inserttitle}
                \par
                {\usebeamercolor[fg]{subtitle in titlepage}%
                 \usebeamerfont{subtitle in titlepage} \insertsubtitle}
                 \par
                \vspace*{0.7em}
                {\usebeamercolor[fg]{author in titlepage}%
                 \usebeamerfont{author in titlepage} \insertauthor}
            \end{flushright} % XXXX
        \end{minipage}
    };%
  \end{tikzpicture}%
  \showLogoRightSide%
}


% ---------------------------------------------------------------------------
%
% Frame title template:
%

\defbeamertemplate{headline}{sectioninhead-new}{%
  \hbox{%
    \begin{beamercolorbox}[%
            % wd=\paperwidth,
            ht=14pt, % war: 6.0ex,
            dp=2pt, % war: 1ex,
            sep=0.1pt, %
            leftskip=\myleftskip, %
            rightskip=\myrightskip, %
        ]{headline}%
        {%
              \usebeamercolor[fg]{section in head}%
              \usebeamerfont{section in head}%
              \ifthenelse{\equal{\thesection}{0}}{}{%
                    \thesection.~\NoHyper\insertsection\endNoHyper%\phantom{X}%
              }%
        }%
    \end{beamercolorbox}%
  }%
}

\defbeamertemplate{headline}{sectioninhead}{%
  \nointerlineskip%
  \begin{beamercolorbox}[%
      ht=14pt, % war: 6.0ex,
      dp=3pt, % war: 1ex,
      sep=0.1pt, %
      leftskip=\myleftskip, %
      rightskip=\myrightskip, %
  ]{headline}
    {%
      \usebeamercolor[fg]{section in head}%
      \usebeamerfont{section in head}%
      \ifthenelse{\equal{\thesection}{0}}{}{%
      \thesection.~\NoHyper\insertsection\endNoHyper%
      }%
    }%
  \end{beamercolorbox}%
  \nointerlineskip%
}

\defbeamertemplate{headline}{nosectioninhead}{%
  \nointerlineskip%
  \begin{beamercolorbox}[%
      ht=14pt, % war: 6.0ex,
      dp=3pt, % war: 1ex,
      sep=0.1pt, %
      leftskip=\myleftskip, %
      rightskip=\myrightskip, %
  ]{headline}

  \end{beamercolorbox}%
  \nointerlineskip%
}

\defbeamertemplate{headline}{nosectioninheadDLS}{%
\relax%
}

\defbeamertemplate{headline}{sectioninheadDLS}{%
\relax%
}


\defbeamertemplate{headline}{minimal}{
\relax%
}

%
% ---------------------------------------------------------------------------
%
\defbeamertemplate{frametitle}{minimal}{%
  \usebeamercolor[fg]{frametitle in head}%
  \usebeamerfont{frametitle in head}%
  \insertframetitle%
}

\newlength{\mytitleboxlength}
\newlength{\npbttitleboxheight}
\newlength{\npbttitleboxwidth}
\newlength{\npbttitleboxheightPDF}
\newlength{\npbttitleboxheightXelatex}

\defbeamertemplate{frametitle}{normal}{%
    \setlength{\mytitleboxlength}{\textwidth}%
    \addtolength{\mytitleboxlength}{-1.4cm}%
    \sbox{\myftbox}{%
        \ifnpbtexercisemode{%
            \usebeamercolor[fg]{frametitle in head exercise}%
            \usebeamerfont{frametitle in head exercise}%
            \insertframetitle%
        }\else{%
            \usebeamercolor[fg]{frametitle in head}%
            \usebeamerfont{frametitle in head}%
            \insertframetitle%
        }\fi%
     }% end of savebox!
    \savebox{\maxheightbox}{%
        \ifnpbtexercisemode{%
            \usebeamercolor[fg]{frametitle in head exercise}%
            \usebeamerfont{frametitle in head exercise}%
        }\else{%
            \usebeamercolor[fg]{frametitle in head}%
            \usebeamerfont{frametitle in head}%
        }\fi%
    }% end of savebox!
    \usebeamercolor[fg]{frametitle in head exercise}%
    \settoheight{\npbttitleboxheightPDF}{\usebox{\maxheightbox}}% Für PDF-LaTeX
    \message{the npbttitleboxheightPDF=\the\npbttitleboxheightPDF}
    \setlength{\npbttitleboxheightXelatex}{4mm}% Für XeLaTeX
    \message{the npbttitleboxheightXelatex=\the\npbttitleboxheightXelatex}
    \setlength{\npbttitleboxheight}{%
        \expandafter\ifpdftex{\expandafter\npbttitleboxheightPDF}\else{\expandafter\npbttitleboxheightXelatex}\fi%
    }%
    \message{the npbttitleboxheight=\the\npbttitleboxheight}
    %\ifxetex{\vskip-0.75mm}\else{\vskip-1.06mm}\fi%\vskip4.5pt%
    \ifpdftex{\vskip-1.06mm}\else{\vskip-0.77mm}\fi%\vskip4.5pt%
    \ifnpbtexercisemode{%
        \vskip-1.06mm%
        \addtolength{\npbttitleboxheight}{1.06mm}%
        {\usebeamerfont{frametitle in head exercise}%
        \usebeamercolor[fg]{frametitle in head exercise}%
        \colorbox{bg}{\makebox[\mytitleboxlength][l]{\parbox[b][\npbttitleboxheight][c]{0mm}{}}}}%
        \vskip1.004mm%
    }\else{%
        {\usebeamerfont{frametitle in head}%
        \usebeamercolor[fg]{frametitle in head}%
        \addtolength{\mytitleboxlength}{1.34mm}%
        \parbox[b][\npbttitleboxheight][c]{0pt}{}\hspace{-1.34mm}{\textcolor{fg}{\rule{\mytitleboxlength}{1pt}}}}%
    }\fi% end of ifnpbtexercisemode
    \vskip-\npbttitleboxheight%
    %\vskip-4pt%
    \settowidth{\myftboxwidth}{\phantom{\usebox{\myftbox}}}%
    \message{Breite: \the\myftboxwidth \usebox{\myftbox}}%
    \ifnpbtexercisemode{%
        \usebeamercolor[fg]{frametitle in head exercise}%
        \usebeamerfont{frametitle in head exercise}%
        \vskip0.62mm%
    }\else{%
        \usebeamercolor[fg]{frametitle in head}%
        \usebeamerfont{frametitle in head}%
    }\fi%  end of ifnpbtexercisemode
    \ifpdftex{\vskip-1em}\else{\vskip-6mm}\fi%\vskip4.5pt%
    \ifdim\myftboxwidth>\mytitleboxlength{%
        \resizebox{\mytitleboxlength}{!}{\usebox{\myftbox}}\\[-0.85em]
    }\else{%
        \usebox{\myftbox}\\[-0.85em]
    }\fi% end of ifdem
    \showLogoRightSide%
    %\ifxetex{\vskip5mm}\else{\vskip0pt}\fi%
    %\ifxetex{\vskip-5mm}\else{\vskip0pt}\fi%
}

\newlength{\npbtmaxframetitlewidth}
\defbeamertemplate{frametitle}{normalDLS}{%
    %\message{frametitle start}%
    \setlength{\npbtmaxframetitlewidth}{480pt}% Im PPTX Orginal 26 cm
    \begin{tikzpicture}[remember picture, overlay]
        \node[yshift=-0.75cm] at (current page.north){%
            \ifnpbtexercisemode{%
                %\message{exercisemode is TRUE in frametitle}%
                \includegraphics[width=\myPaperWidth]{images/NPBT-FOM-DLS-frametitle-exercise.png}%
            }\else{%
                %\message{exercisemode is FALSE in frametitle}%
                \includegraphics[width=\myPaperWidth]{images/NPBT-FOM-DLS-frametitle-default.png}%
            }\fi%
          };%
    \end{tikzpicture}%
    \vskip-0.30cm%\vskip-0.9cm%
    \savebox{\myftbox}{%
        \usebeamercolor[fg]{frametitle in head}%
        \usebeamerfont{frametitle in head}%
        \insertframetitle%
    }% end of savebox!
    \settowidth{\myftboxwidth}{\usebox{\myftbox}}%
    \ifnpbtexercisemode{%
        % Korrektur für Icon am Anfang der Zeile (ca. 2.3 em)
        \addtolength{\npbtmaxframetitlewidth}{-2.3em}\hspace*{2.3em}%
    }\else\relax\fi%
    \ifdim\myftboxwidth>\npbtmaxframetitlewidth{%
        \resizebox{\npbtmaxframetitlewidth}{!}{\usebox{\myftbox}}%
    }\else{ %
        \usebox{\myftbox}%
    }\fi% end of ifdem
    %\message{frametitle end}%
}


% ---------------------------------------------------------------------------
%
% Footline template
%
\defbeamertemplate{footline}{nofootline}{%
  \relax%
}

\defbeamertemplate{footline}{normalDLS}{%
    %\message{footline start}%
    \ifthenelse{\equal{\insertframenumber}{1}}{%
    }{\begin{tikzpicture}[remember picture, overlay]
        \node[yshift=0.7cm, xshift=-0.6cm] at (current page.south east){%
                \ifnpbtexercisemode{%
                    %\message{exercisemode is TRUE in footline}%
                    \raggedleft{%
                        \usebeamercolor[fg]{number in footline exercise}%
                        \usebeamerfont{number in footline exercise}%
                        \insertframenumber%
                    }%
                }\else{%
                    %\message{exercisemode is FALSE in footline}%
                    \raggedleft{%
                        \usebeamercolor[fg]{number in footline}%
                        \usebeamerfont{number in footline}%
                        \insertframenumber%
                    }%
                }\fi%

        };%
    \end{tikzpicture}%
    \vspace*{1.5em}
    }
    %\message{footline end}%
}

\defbeamertemplate{footline}{normal}{% Skip first frame == Title frame !!!
%    \leavevmode%
    \setlength{\mytitleboxlength}{\textwidth}%
    \addtolength{\mytitleboxlength}{-0.8cm}%
    \ifthenelse{\equal{\insertframenumber}{1}}{%
    }{%
      \begin{beamercolorbox}[%
          ht=0.08ex,
          leftskip=\myleftskip,
          rightskip=\myrightskip
        ]{footline}
            \usebeamerfont{frametitle in head}%
            \usebeamercolor{frametitle in head}%
            \addtolength{\mytitleboxlength}{4pt}%
            {\textcolor{fg}{\rule{\mytitleboxlength}{1pt}}}%
      \end{beamercolorbox}%
      \begin{beamercolorbox}[%
          ht=1.25ex,
          %dp=2.25ex,
          dp=1.35ex,
          leftskip=\myleftskip,
          rightskip=\myrightskip
        ]{footline}
        {%
          {%
            \usebeamercolor{date in footline}%
            \usebeamerfont{date in footline}%
            \insertdate  %
          }%
          \hfill%
          {%
            {%
              \usebeamercolor{author in footline}%
              \usebeamerfont{author in footline}%
              \insertshortauthor  %
            }%
            {%
              \usebeamercolor{separator in footline}%
              \usebeamerfont{separator in footline}%
              \hspace{\mysepsize}$|$\hspace{\mysepsize}%
            }%
            {%
              \usebeamercolor{title in footline}%
              \usebeamerfont{title in footline}%
              \inserttitle  %
            }%
          }%
          \hfill%
          \vspace*{-0.9em}%
          \raggedleft{%
            \usebeamercolor{number in footline}%
            \usebeamerfont{number in footline}%
            \insertframenumber \hspace*{0.3cm}%
          }%
        }%
      \end{beamercolorbox}
      \vspace*{0.2cm}
    }
}

% ---------------------------------------------------------------------------
%
% Section page template
%
%\setbeamertemplate{section page}
%{
%    \begin{centering}
%    \begin{beamercolorbox}[sep=12pt,center]{section title}
%      \usebeamerfont{section title}\insertsection\par
%    \end{beamercolorbox}
%    \end{centering}
%}
% ********
% FIX ME: Orginal aus dem PPTX: 4,41cm von rechts, 10,23cm vob oben ist eine 3,47cm hohe und
% ======= 18,85cm breite Box die von rechts unten her gefüllt wird!
% ********

\defbeamertemplate{section page}{minimal}
{
  \vfill\insertsectionhead\vfill
}

\defbeamertemplate{section page}{normal}
{
  \begin{tikzpicture}[remember picture, overlay]
    \node[anchor=south east,xshift=-1cm,yshift=1.5cm] at (current page.south east){%
        \begin{minipage}[b][\sectionpageheight][t]{\sectionpagewidth}
        \sectionpageheight x \sectionpagewidth
          \begin{FlushRight}
              \usebeamercolor{sectionnumber title}%
              \usebeamerfont{sectionnumber title}\insertsectionnumber %
              \usebeamercolor{section title}%
              \usebeamerfont{section title}\insertsectionhead\par
          \end{FlushRight}
        \end{minipage}
    };%
  \end{tikzpicture}
}

\defbeamertemplate{section page}{normalDLS-old}
{
  \begin{tikzpicture}[remember picture, overlay]
    \node[%
        rectangle,
        anchor = south east,
        xshift = -1cm,
        yshift = 1.5cm] at (current page.south east){%
        \begin{minipage}[b][\sectionpageheight][t]{\sectionpagewidth}
          % \sectionpageheight x \sectionpagewidth
          \begin{FlushRight}
              \usebeamercolor{sectionnumber title}%
              \usebeamerfont{sectionnumber title}\insertsectionnumber %
              \usebeamercolor{section title}%
              \usebeamerfont{section title}\insertsectionhead\par
          \end{FlushRight}
        \end{minipage}
    };%
  \end{tikzpicture}
}
\defbeamertemplate{section page}{normalDLS}
{
  \begin{tikzpicture}[remember picture, overlay]
    % Sectionnumber
    \node[%
        rectangle,
        anchor = south east,
        xshift = -1cm,
        yshift = 1.5cm] at (current page.south east){%
        \begin{minipage}[3cm][t]{4,7cm}
            \centering XXXX
            \usebeamercolor{sectionnumber title}%
            \usebeamerfont{sectionnumber title}\insertsectionnumber
        \end{minipage}
    }%
    % Sectiontitle
    \node[%
        rectangle,
        anchor = south east,
        xshift = -1cm,
        yshift = 1.5cm] at (current page.south east){%
        \begin{minipage}[b][3cm][t]{25.23cm}
          % \sectionpageheight x \sectionpagewidth
          \begin{FlushRight}
             YYYY
              \usebeamercolor{section title}%
              \usebeamerfont{section title}\insertsectionhead\par
          \end{FlushRight}
        \end{minipage}
    };%
  \end{tikzpicture}
}


% ---------------------------------------------------------------------------
%
% Subsection page template
%
\defbeamertemplate{subsection page}{minimal}
{
  \vfill\insertsubsectionhead\vfill
}

\defbeamertemplate{subsection page}{normal}
{ %%% HOTFIX !!!! %%%
  \ifwider{
   \message{USE WIDER SUBSECTION!}
   \begin{tikzpicture}[remember picture, overlay]
        \node[anchor=south east,xshift=17cm,yshift=3.5cm] at (current page.south east){%
            \begin{minipage}[b][\sectionpageheight][t]{\sectionpagewidth}

              %\sectionpageheight x \sectionpagewidth

              \begin{FlushRight}
                  \usebeamercolor{sectionnumber title}%
                  \usebeamerfont{sectionnumber title}\insertsubsectionnumber %
                  \usebeamercolor{section title}%
                  \usebeamerfont{section title}\insertsubsectionhead\par
              \end{FlushRight}
            \end{minipage}
        };%
      \end{tikzpicture}
  } \else {
      \message{DONOT USE WIDER SUBSECTION!}
      \begin{tikzpicture}[remember picture, overlay]
        \node[anchor=south east,xshift=-3cm,yshift=3.5cm] at (current page.south east){%
            \begin{minipage}[b][\sectionpageheight][t]{\sectionpagewidth}

              %\sectionpageheight x \sectionpagewidth

              \begin{FlushRight}
                  \usebeamercolor{sectionnumber title}%
                  \usebeamerfont{sectionnumber title}\insertsubsectionnumber %
                  \usebeamercolor{section title}%
                  \usebeamerfont{section title}\insertsubsectionhead\par
              \end{FlushRight}
            \end{minipage}
        };%
      \end{tikzpicture}
    }\fi
}

% ---------------------------------------------------------------------------
%
% Note page (default) updated!
%
\newsavebox{\mytempbox}
\defbeamertemplate{note page}{mydefault}
{\notesmodetrue
  {%
    \scriptsize
    \usebeamerfont{note title}\usebeamercolor[fg]{note title}%
    \ifbeamercolorempty[bg]{note title}{}{%
      \insertvrule{.25\paperheight}{note title.bg}%
      \vskip-.25\paperheight%
      \nointerlineskip%
    }%
    \vbox{%
      % ORiGNAL:
      %\hspace*{.6875\paperwidth}\insertslideintonotes{0.25}%
      %\vskip-0.25\paperheight%
      \hspace*{.66\paperwidth}\insertslideintonotes{0.25}%
      \vskip-0.25\paperheight%
      \nointerlineskip
      \begin{pgfpicture}{0cm}{0cm}{0cm}{0cm}
        \begin{pgflowlevelscope}{\pgftransformrotate{90}}
          {\pgftransformshift{\pgfpoint{-2cm}{0.2cm}}%
          \pgftext[base,left]{\usebeamerfont{note date}\usebeamercolor[fg]{note date}\the\year-\ifnum\month<10\relax0\fi\the\month-\ifnum\day<10\relax0\fi\the\day}}
        \end{pgflowlevelscope}
      \end{pgfpicture}
    }%
    \nointerlineskip
    \vbox to .25\paperheight{\vskip0.5em
      \hbox{\insertshorttitle[width=8cm]}%
      \setbox\mytempbox=\hbox{\insertsection}%
      \hbox{\ifdim\wd\mytempbox>1pt{\hskip4pt\raise3pt\hbox{\vrule
            width0.4pt height7pt\vrule width 9pt
            height0.4pt}}\hskip1pt\hbox{\begin{minipage}[t]{7.5cm}\def\breakhere{}\insertsection\end{minipage}}\fi%
      }%
      \setbox\mytempbox=\hbox{\insertsubsection}%
      \hbox{\ifdim\wd\mytempbox>1pt{\hskip17.4pt\raise3pt\hbox{\vrule
            width0.4pt height7pt\vrule width 9pt
            height0.4pt}}\hskip1pt\hbox{\begin{minipage}[t]{7.5cm}\def\breakhere{}\insertsubsection\end{minipage}}\fi%
      }%
      \setbox\mytempbox=\hbox{\insertshortframetitle}%
      \hbox{\ifdim\wd\mytempbox>1pt{\hskip30.8pt\raise3pt\hbox{\vrule
            width0.4pt height7pt\vrule width 9pt
            height0.4pt}}\hskip1pt\hbox{\insertshortframetitle[width=7cm]}\fi%
      }%
      \vfil}%
  }%
  \ifbeamercolorempty[bg]{note page}{}{%
    \nointerlineskip%
    \insertvrule{.75\paperheight}{note page.bg}%
    \vskip-.75\paperheight%
  }%
  \vskip.25em
  \nointerlineskip
  %
  %\textwidth=10.8cm%
  \ifDLS{\textwidth=10.8cm}\else{\textwidth=13.8cm}\fi%
  \hsize=\textwidth%
  %
  \insertnote
  \notesmodefalse
}

%
% ---------------------------------------------------------------------------
% Minimal Setup
%
\newcommand*{\setNPBTminimal}{%
    \setbeamertemplate{subsection page}[minimal]%
    \setbeamertemplate{note page}[mydefault]%
    \setbeamertemplate{title page}[minimal]%
    \setbeamertemplate{headline}[minimal]%
    \setbeamertemplate{footline}[nofootline]%
    \setbeamertemplate{frametitle}[minimal]%
    \setbeamertemplate{section page}[minimal]%
}
%
% ---------------------------------------------------------------------------
% Normal Setup
%
\newcommand*{\setNPBTnormal}{%
    \setbeamertemplate{subsection page}[normal]%
    \setbeamertemplate{note page}[mydefault]%
    \setbeamertemplate{title page}[normal]%
    \setbeamertemplate{headline}[sectioninhead]%
    \setbeamertemplate{footline}[normal]%
    \setbeamertemplate{frametitle}[normal]%
    \setbeamertemplate{section page}[normal]%
}
%
% ---------------------------------------------------------------------------
% Normal Setup
%
\newcommand*{\setNPBTnormalDLS}{%
    \setbeamertemplate{subsection page}[normal]%
    \setbeamertemplate{note page}[mydefault]%
    \setbeamertemplate{title page}[normal]%
    \setbeamertemplate{headline}[nosectioninheadDLS]%
    \setbeamertemplate{footline}[normalDLS]%
    \setbeamertemplate{frametitle}[normalDLS]%
    \setbeamertemplate{section page}[normal]%
}
%\setNPBTminimal{}
\setNPBTnormal{}
%\setNPBTminimal{}
\InputIfFileExists{customize_theme.tex}{\relax}{\relax}

\newcommand*{\cemph}{\it}
\newcommand*{\cstrong}{\bf}

\usecolortheme{NPBT-SC}

% = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

% ---------------------------------------------------------------------------
% Exercise Counter
%
\newcounter{exerciseCounter}
\newcommand{\nextExercise}{\ifnotesmode{\relax}\else{\stepcounter{exerciseCounter}}\fi\theexerciseCounter}
\newcommand{\thisExercise}{\theexerciseCounter}

\mode<all>
\message{Ending 'beamerthemeNPBT' -------------------------------------------}
%
% ===========================================================================
%
